<!DOCTYPE html>
<html lang="lo">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@100..900&display=swap" rel="stylesheet">
<title>‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç 10 + Total (‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡ªÑ‡∫ß‡ªâ)</title>
<style>
  body{margin:0;font-family:"Noto Sans Lao", Inter, system-ui;background: var(--bg);color:#111827;padding:22px}
  h2 { color: #333; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; }
  th, td { border: 1px solid #9c9c9c; padding: 10px; text-align: center; }
  th { background: linear-gradient(90deg, #5ce4e7, #07a8ff); color: white; font-weight: bold; }
  td[contenteditable="true"] { background: #ffffff; border-radius: 4px; min-width: 60px; }
  tfoot td { font-weight: bold; background: #dfe6e9; }
  button { cursor: pointer; padding: 6px 12px; border: none; border-radius: 5px; background: #0984e3; color: white; transition: 0.3s; }
  button:hover { background: #74b9ff; }
  .addRowBtn { margin-top: 10px; background: #00b894; }
  .addRowBtn:hover { background: #55efc4; }
  .clearBtn { margin-top: 10px; background: #d63031; }
  .clearBtn:hover { background: #ff7675; }
  #goHome { margin-bottom:15px; padding:8px 16px; background:#009f95; color:white; border:none; border-radius:6px; font-size:16px; }
  #goHome:hover { background:#ff0000; }
  .popup-overlay {
    display: none; position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000;
  }
  .popup { background: #fff; padding: 25px 35px; border-radius: 12px; text-align: center; max-width: 320px; width: 90%; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: fadeIn 0.3s ease; }
  .popup button { margin: 12px; padding: 8px 16px; }
  #confirmDelete { background: #d63031; color: white; }
  #confirmDelete:hover { background: #ff7675; }
  #cancelDelete { background: #b2bec3; }
  #cancelDelete:hover { background: #636e72; }
  @keyframes fadeIn { from {opacity:0; transform: translateY(-20px);} to {opacity:1; transform: translateY(0);} }
</style>
</head>
<body>

<button id="goHome">üè† ‡∫Å‡∫±‡∫ö‡ªÑ‡∫õ Home</button>

<h2>‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç(‡ªú‡ªâ‡∫≤‡∫Æ‡ªâ‡∫≤‡∫ô)</h2>
<table class="expenseTable" data-id="table1">
  <thead>
    <tr>
      <th>‡∫à‡∫≥‡∫ô‡∫ß‡∫ô</th>
      <th>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô/‡∫õ‡∫µ ‡ªÄ‡∫ß‡∫•‡∫≤</th>
      <th>‡ªù‡∫≤‡∫ç‡ªÄ‡ªÄ‡∫´‡∫î</th>
      <th>‡∫à‡ªç‡∫≤‡∫ô‡∫ß‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td colspan="3">Total</td>
      <td class="totalAmount">0</td>
      <td></td>
    </tr>
  </tfoot>
</table>
<button class="addRowBtn">üìÅ ‡ªÄ‡∫û‡∫µ‡ªâ‡∫°‡ªÅ‡∫ñ‡∫ß</button>

<h2>‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç(‡∫≠‡∫≠‡∫ô‡∫•‡∫≤‡∫ç ONLINE)</h2>
<table class="expenseTable" data-id="table2">
  <thead>
    <tr>
      <th>‡∫à‡∫≥‡∫ô‡∫ß‡∫ô</th>
      <th>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô/‡∫õ‡∫µ ‡ªÄ‡∫ß‡∫•‡∫≤</th>
      <th>‡ªù‡∫≤‡∫ç‡ªÄ‡ªÄ‡∫´‡∫î</th>
      <th>‡∫à‡ªç‡∫≤‡∫ô‡∫ß‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td colspan="3">Total</td>
      <td class="totalAmount">0</td>
      <td></td>
    </tr>
  </tfoot>
</table>
<button class="addRowBtn">‚ûï ‡ªÄ‡∫û‡∫µ‡ªâ‡∫°‡ªÅ‡∫ñ‡∫ß</button>

<h2>Grand Total</h2>
<div id="grandTotal" style="font-size:20px; font-weight:bold; color:#2d3436;">0</div>

<button id="clearAll" class="clearBtn">üßπ ‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</button>
<button id="sendWhatsapp" style="margin-top:15px; background:#25d366; font-size:16px;">
üì§ ‡∫™‡∫ª‡ªà‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÑ‡∫õ WhatsApp
</button>

<div class="popup-overlay" id="popupOverlay">
  <div class="popup">
    <p>‡∫ó‡ªà‡∫≤‡∫ô‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫ª‡∫ö‡ªÅ‡∫ñ‡∫ß‡∫ô‡∫µ‡ªâ‡∫à‡∫¥‡∫á‡∫´‡∫•‡∫∑?</p>
    <button id="confirmDelete">‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô</button>
    <button id="cancelDelete">‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å</button>
  </div>
</div>

<script>
let rowToDelete = null;
document.getElementById('goHome').addEventListener('click', ()=>{ window.location.href = 'index.html'; });
function getTableKey(table){ return 'expense_'+table.dataset.id; }
function addRow(tbody, index, data={}){
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${index}</td>
    <td contenteditable="true" class="date">${data.date||'--/--/---- --:--'}</td>
    <td contenteditable="true" class="remark">${data.remark||`‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô ${index}`}</td>
    <td contenteditable="true" class="amount">${data.amount||'0'}</td>
    <td><button class="deleteBtn">üóëÔ∏è‡∫•‡∫ª‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô</button></td>
  `;
  tbody.appendChild(tr);
}
document.querySelectorAll('.expenseTable').forEach(table=>{
  const tbody = table.querySelector('tbody');
  const saved = JSON.parse(localStorage.getItem(getTableKey(table)))||[];
  if(saved.length>0){ saved.forEach((row,i)=>addRow(tbody,i+1,row)); }
  else { for(let i=1;i<=10;i++) addRow(tbody,i); }
  updateTotal(table);
});
document.querySelectorAll('.addRowBtn').forEach((btn, idx)=>{
  btn.addEventListener('click', ()=>{
    const table = document.querySelectorAll('.expenseTable')[idx];
    const tbody = table.querySelector('tbody');
    const newIndex = tbody.querySelectorAll('tr').length+1;
    addRow(tbody,newIndex);
    updateTotal(table);
    saveTable(table);
  });
});
document.body.addEventListener('click', e=>{
  if(e.target.classList.contains('deleteBtn')){
    rowToDelete = e.target.closest('tr');
    document.getElementById('popupOverlay').style.display='flex';
  }
});
document.getElementById('confirmDelete').addEventListener('click', ()=>{
  if(rowToDelete){
    const table = rowToDelete.closest('table');
    rowToDelete.remove();
    table.querySelectorAll('tbody tr').forEach((tr,i)=>tr.children[0].textContent=i+1);
    updateTotal(table);
    saveTable(table);
    rowToDelete=null;
  }
  document.getElementById('popupOverlay').style.display='none';
});
document.getElementById('cancelDelete').addEventListener('click', ()=>{
  rowToDelete=null;
  document.getElementById('popupOverlay').style.display='none';
});

function updateTotal(table){
  let total=0;
  table.querySelectorAll('.amount').forEach(a=>{
    const val = parseInt(a.textContent.replace(/,/g,''));
    if(!isNaN(val)) total+=val;
  });
  table.querySelector('.totalAmount').textContent = total.toLocaleString();
  updateGrandTotal();
}
function updateGrandTotal(){
  let grand=0;
  document.querySelectorAll('.expenseTable').forEach(table=>{
    const val = parseInt(table.querySelector('.totalAmount').textContent.replace(/,/g,''));
    if(!isNaN(val)) grand+=val;
  });
  document.getElementById('grandTotal').textContent = grand.toLocaleString();
}

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç remark / amount
document.body.addEventListener('input', e=>{
  const tr = e.target.closest('tr');
  const table = e.target.closest('table');
  if(e.target.classList.contains('remark')){
    const now = new Date();
    const day = String(now.getDate()).padStart(2,'0');
    const month = String(now.getMonth()+1).padStart(2,'0');
    const year = now.getFullYear();
    const hours = String(now.getHours()).padStart(2,'0');
    const minutes = String(now.getMinutes()).padStart(2,'0');
    tr.querySelector('.date').textContent = `${day}/${month}/${year} ${hours}:${minutes}`;
  }
  if(e.target.classList.contains('amount')){
    let val = e.target.textContent.replace(/,/g,'').replace(/[^\d]/g,'');
    e.target.textContent = val;
  }
  updateTotal(table);
  saveTable(table);
});

// format comma on blur
document.body.addEventListener('blur', e=>{
  if(e.target.classList.contains('amount')){
    let val = parseInt(e.target.textContent.replace(/,/g,''));
    e.target.textContent = !isNaN(val)? val.toLocaleString():'0';
    const table = e.target.closest('table');
    updateTotal(table);
    saveTable(table);
  }
}, true);

function saveTable(table){
  const data = [];
  table.querySelectorAll('tbody tr').forEach(tr=>{
    data.push({
      date: tr.querySelector('.date').textContent,
      remark: tr.querySelector('.remark').textContent,
      amount: tr.querySelector('.amount').textContent
    });
  });
  localStorage.setItem(getTableKey(table), JSON.stringify(data));
}

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(confirm("‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î?")){
    localStorage.clear();
    location.reload();
  }
});

document.getElementById('sendWhatsapp').addEventListener('click', ()=>{
  let message = "üìä ‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç\n\n";
  document.querySelectorAll('.expenseTable').forEach((table, idx)=>{
    message += (idx===0? "üõí ‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç(‡ªú‡ªâ‡∫≤‡∫Æ‡ªâ‡∫≤‡∫ô)\n":"üåê ‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç(‡∫≠‡∫≠‡∫ô‡∫•‡∫≤‡∫ç)\n");
    table.querySelectorAll('tbody tr').forEach(tr=>{
      const date = tr.querySelector('.date').textContent;
      const remark = tr.querySelector('.remark').textContent;
      const amount = tr.querySelector('.amount').textContent;
      message += `- ${date} | ${remark} | ${amount}\n`;
    });
    message += `Total: ${table.querySelector('.totalAmount').textContent}\n\n`;
  });
  const grand = document.getElementById('grandTotal')?.textContent || "";
  message += `üí∞ Grand Total: ${grand}`;
  const url = "https://wa.me/?text=" + encodeURIComponent(message);
  window.open(url, "_blank");
});
</script>
</body>
</html>

