<!DOCTYPE html>
<html lang="lo">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡∫™‡∫∞‡∫´‡∫º‡∫∏‡∫ö‡∫•‡∫≤‡∫ç‡∫Æ‡∫±‡∫ö - ‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç</title>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@100..900&display=swap" rel="stylesheet">

<style>
:root{
--bg:#f0f6fb; --card:#ffffff; --muted:#6b7280; --accent:#0b6b4a;
--accent-2:#1976d2; --good:#25D366; --danger:#f57f17;
--radius:14px;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Noto Sans Lao", Inter, system-ui;background: var(--bg);color:#111827;padding:22px}
.wrap{max-width:1100px;margin:0 auto}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
h1{margin:0;font-size:20px;color:var(--accent);font-weight:700}
#datetime{font-size:50px;color:var(--muted)}
.card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 12px 30px rgba(7,22,34,0.06);overflow:hidden}    
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.group{background:linear-gradient(180deg,#9efbe5,#9cefff);border-radius:12px;padding:12px;border:1px solid rgba(11,107,74,0.06);box-shadow:0 6px 18px rgba(2,6,23,0.04)}
.title{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.credit{background:#02ff3d}
.dot.cash{background:#ff0000}
.dot.other{background:#4800ff}
.title h3{margin:0;font-size:15px;color:var(--accent)}
.title p{margin:0;font-size:12px;color:var(--muted)}
table{width:100%;border-collapse:collapse}
th,td{padding:8px 10px;border-bottom:1px dashed rgba(15,23,42,0.04);vertical-align:middle}
th{font-weight:700;color:#0f172a;text-align:left;font-size:13px}
td.label{color:var(--muted);font-size:13px}
.value{min-width:110px;text-align:right;font-weight:700;font-size:14px}
[contenteditable="true"]{background:rgba(255,255,255,0.8);padding:6px;border-radius:8px;outline:none}
.totalCard{margin-top:12px;display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(11,107,74,0.06), rgba(11,107,74,0.02));border:1px solid rgba(11,107,74,0.06)}
.totalCard .label{font-weight:800;color:var(--accent)}
.totalCard .amount{font-weight:900;font-size:20px}
.amount.accent{color:var(--accent-2)}
.btns{margin-top:14px;display:flex;justify-content:flex-end;gap:10px;flex-wrap:wrap}
button.btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;font-size:13px;transition:transform .15s,box-shadow .15s}
button.ghost{background:transparent;color:var(--muted);border:1px solid rgba(2,6,23,0.06)}
button.blue{background:var(--accent-2);color:#fff}
button.green{background:var(--good);color:#fff}
button.warn{background:var(--danger);color:#fff}
button.btn:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(2,6,23,0.08)}
@media (max-width:900px){.grid{grid-template-columns:1fr}.btns{justify-content:center}}
@media (max-width:600px){
.grid{grid-template-columns:1fr}
.totalCard{flex-direction:column;align-items:flex-start}
.btns{justify-content:center;flex-wrap:wrap}
[contenteditable="true"]{font-size:16px;padding:8px}
}

/* --- modal styles (small, unobtrusive, matches design) --- */
.modal-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(2,6,23,0.45);
  z-index:1200;
  align-items:center;
  justify-content:center;
  padding:18px;
}
.modal {
  width:100%;
  max-width:420px;
  background:var(--card);
  border-radius:14px;
  padding:18px;
  box-shadow:0 18px 50px rgba(2,6,23,0.3);
  transform:translateY(0);
  animation:modalIn .22s ease;
}
.modal h3{margin:0 0 8px;color:var(--accent-2)}
.modal p{margin:0 0 14px;color:var(--muted)}
.modal .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
.modal .modal-actions .btn{min-width:110px}
.modal .preview{white-space:pre-wrap;background:#f7f9fb;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.04);max-height:260px;overflow:auto;font-family:monospace;font-size:13px;color:#111}
/* small phone input */
.modal .phoneRow{display:flex;gap:8px;align-items:center}
.modal input[type="text"]{flex:1;padding:8px;border-radius:10px;border:1px solid rgba(2,6,23,0.06);outline:none}

/* animations */
@keyframes modalIn {
  from{opacity:0; transform:translateY(-10px)}
  to{opacity:1; transform:translateY(0)}
}
</style>
</head>
<body>
  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Home -->
<button id="‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç">üõí‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç</button>
<script>// ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Home
document.getElementById('‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç').addEventListener('click', ()=>{
  window.location.href = 'index2.HTML'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏´‡∏ô‡πâ‡∏≤ Home ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
});
</script>
<style>
  /* Home button */
  #‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç { margin-bottom:15px; padding:8px 16px; background:#0ee6a5; color:rgb(0, 0, 0); border:none; border-radius:6px; font-size:26px; }
  #‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç:hover { background:#ff0000fa; }

</style>
  
<div class="wrap">
<header>
<h1>‡∫ï‡∫≤‡∫ï‡∫∞‡∫•‡∫≤‡∫á</h1>
<div id="datetime">--/--/---- --:--:--</div>
</header>

<div class="card" id="reportCard">
<div class="grid">
<!-- CREDIT -->
<div class="group" aria-labelledby="g-credit">
<div class="title"><div class="dot credit"></div><div><h3 id="g-credit">CREDIT(IN)+CASH(‡ªÄ‡∫õ‡∫µ‡∫î)	</h3><p>‡∫ç‡∫≠‡∫î‡ªÄ‡∫õ‡∫µ‡∫î-‡ªÄ‡∫Ñ‡∫î‡∫¥‡∫î‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤</p></div></div>
<table>
<thead><tr><th>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</th><th>‡∫à‡ªç‡∫≤‡∫ô‡∫ß‡∫ô</th></tr></thead>
<tbody>
<tr><td class="label">CASH (‡ªÄ‡∫õ‡∫µ‡∫î)</td><td class="value" id="cash_open" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT IN.(OL)<img src="logo4.png" alt="" width="20px"></td><td class="value" id="credit_in2" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT IN.(OL)<img src="logo5.png" alt="" width="20px"></td><td class="value" id="credit_in3" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT IN.<img src="logo4.png" alt="" width="20px"></td><td class="value" id="credit_in4" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT IN.<img src="logo5.png" alt="" width="20px"></td><td class="value" id="credit_in5" contenteditable="true">0</td></tr>
<tr><td class="label">Total1</td><td class="value amount accent" id="total1">0</td></tr>
</tbody>
</table>
</div>

<!-- CASH / BANK -->
<div class="group" aria-labelledby="g-cash">
<div class="title"><div class="dot cash"></div><div><h3 id="g-cash">‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î / ‡∫ö‡∫±‡∫ô‡∫ä‡∫µ</h3><p>‡∫ç‡∫≠‡∫î‡∫õ‡∫¥‡∫î-‡ªÄ‡∫Ñ‡∫î‡∫¥‡∫î‡∫≠‡∫≠‡∫Å</p></div></div>
<table>
<thead><tr><th>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</th><th>‡∫à‡ªç‡∫≤‡∫ô‡∫ß‡∫ô</th></tr></thead>
<tbody>
<tr><td class="label">CASH (‡∫õ‡∫¥‡∫î)</td><td class="value" id="cash_close" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT OUT.(OL)<img src="logo4.png" alt="" width="20px"></td><td class="value" id="credit_out" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT OUT.(OL)<img src="logo5.png" alt="" width="20px"></td><td class="value" id="credit_out2" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT OUT<img src="logo4.png" alt="" width="20px"></td><td class="value" id="credit_out3" contenteditable="true">0</td></tr>
<tr><td class="label">CREDIT OUT<img src="logo5.png" alt="" width="20px"></td><td class="value" id="credit_out4" contenteditable="true">0</td></tr>
<tr><td class="label">BANK CLOSE</td><td class="value" id="bank_close" contenteditable="true">0</td></tr>
</tbody>
</table>
</div>

<!-- OTHER -->
<div class="group" style="grid-column:1 / -1" aria-labelledby="g-other">
<div class="title"><div class="dot other"></div><div><h3 id="g-other">‡∫≠‡∫∑‡ªà‡∫ô‡ªÜ (Expenses)</h3><p>‡ªÄ‡∫á‡∫µ‡∫ô-‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç‡∫ï‡ªà‡∫≤‡∫á‡ªÜ  </p></div></div>
<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:10px">
<div><div style="font-size:12px;color:var(--muted)"><img src="logo1.jpg" alt="" width="30px">cash(‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫ª‡∫î)</div><div id="cash" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)"><img src="bin.jpeg" alt="" width="15px">TICKET(‡∫ö‡∫¥‡∫ô)</div><div id="ticket" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)">promo(‡ªÇ‡∫õ‡ªÇ‡∫°‡∫ä‡∫±‡∫ô)</div><div id="promo" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)">expense(‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç)</div><div id="expense" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)">expense(OL)(‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫çonline)</div><div id="expenseOL" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)"><img src="batbc.png" alt="" width="40px">‡∫ö‡∫≤‡∫î</div><div id="cash2" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)"><img src="batldb.png" alt="" width="40px">‡∫ö‡∫≤‡∫î</div><div id="cash3" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)">cash4‡∫Å‡∫µ‡∫ö</div><div id="cash4" class="value" style="background:#eee;">0</div></div>
<div><div style="font-size:12px;color:var(--muted)"><img src="kipldb.png" alt="" width="40px">kip</div><div id="kip" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)">cash5‡∫Å‡∫µ‡∫ö</div><div id="cash5" class="value" style="background:#eee;">0</div></div>
<div><div style="font-size:12px;color:var(--muted)"><img src="kipbc.png" alt="" width="40px">kip2</div><div id="kip2" contenteditable="true" class="value">0</div></div>
<div><div style="font-size:12px;color:var(--muted)">cash6‡∫Å‡∫µ‡∫ö</div><div id="cash6" class="value" style="background:#eee;">0</div></div>
<div><div style="font-size:12px;color:var(--muted)"><img src="kipbc.png" alt="" width="40px">kip3</div><div id="kip3" contenteditable="true" class="value">0</div></div>
</div>
<div class="totalCard">
<div><div class="label">TotalExpenses</div></div>
<div><div class="amount accent" id="totalExpenses">0</div></div>
</div>
</div>
</div>

<!-- Grand total -->
<div class="totalCard" style="margin-top:16px">
<div><div class="label">Grand Total</div></div>
<div><div class="amount" id="grand_total">-</div></div>
</div>

<!-- buttons -->
<div class="btns">
<button class="btn ghost" id="pasteData">üìã ‡∫ß‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô</button>
<button class="btn ghost" id="copy">üìë Copy CSV</button>
<button class="btn blue" id="downloadImg">üñºÔ∏è Download PNG</button>
<button class="btn" id="downloadXlsx" style="background:#0b6b4a;color:#fff">üì• Download XLSX</button>
<button class="btn warn" id="reset">‚ôªÔ∏è Reset</button>
<button class="btn green" id="sendWhatsApp">üí¨ Send WhatsApp</button>
</div>
</div>
<style>
  .dg{
   background-color: #02ff3d;
   color: #f9f9f9;
  }
</style>

<!-- Confirm Reset Modal -->
<div id="confirmModalOverlay" class="modal-overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle">
    <h3 id="confirmModalTitle">‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫Å‡∫≤‡∫ô Reset?</h3>
    <p>‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡∫ß‡ªà‡∫≤‡∫à‡∫∞‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î? ‡∫Å‡∫≤‡∫ô‡∫Å‡∫ª‡∫î‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫à‡∫∞‡∫Ñ‡∫∑‡∫ô‡∫Ñ‡ªà‡∫≤‡ªÄ‡∫õ‡∫±‡∫ô 0.</p>
    <div class="modal-actions">
      <button id="confirmYes" class="btn warn">‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô</button>
      <button id="confirmNo" class="btn ghost">‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å</button>
    </div>
  </div>
</div>

<!-- WhatsApp Preview Modal -->
<div id="whatsappModalOverlay" class="modal-overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="whatsappModalTitle">
    <h3 id="whatsappModalTitle">Preview ‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫° (WhatsApp)</h3>
    <p>‡∫Å‡∫ß‡∫î‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫Å‡ªà‡∫≠‡∫ô‡∫™‡∫ª‡ªà‡∫á ‚Äî ‡∫ï‡∫±‡ªâ‡∫á‡ªÄ‡∫ö‡∫µ WhatsApp ‡∫à‡ªà‡∫≤‡∫ç‡∫ö‡ªç‡ªà‡∫ï‡ªâ‡∫≠‡∫á‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô (+856...)</p>
    <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center">
      <div class="phoneRow" style="flex:1">
        <input id="waPhone" type="text" placeholder="85620xxxxxxxx" />
      </div>
    </div>
    <div class="preview" id="waPreview" aria-live="polite"></div>
    <div class="modal-actions">
      <button id="confirmSend" class="btn green">‚úÖ ‡∫™‡∫ª‡ªà‡∫á</button>
      <button id="cancelSend" class="btn ghost">‚ùå ‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å</button>
    </div>
  </div>
</div>


<script>
// --- datetime ---
(function datetimeLoop(){
const monthNames = ["‡∫°.‡∫Å","‡∫Å.‡∫û","‡∫°.‡∫ô","‡∫°.‡∫™","‡∫û.‡∫û","‡∫°‡∫¥","‡∫Å.‡∫•","‡∫™.‡∫´","‡∫Å.‡∫ç","‡∫ï.‡∫•","‡∫û.‡∫à","‡∫ó.‡∫ô"];
function upd(){
  const d=new Date();
  document.getElementById('datetime').textContent = `${String(d.getDate()).padStart(2,'0')} ${monthNames[d.getMonth()]} ${d.getFullYear()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
}
upd(); setInterval(upd,1000);
})();

// --- Editable IDs ---
const editableIds = ["credit_in","credit_in2","credit_in3","credit_in4","credit_in5","credit_out","credit_out2","credit_out3","credit_out4","cash_open","cash_close","bank_close","cash","ticket","promo","expense","expenseOL","cash2","cash3","kip","kip2","kip3",];
// helper: parse number from element (supports comma/space)
function parseCell(id){
  const el=document.getElementById(id);
  if(!el) return 0;
  const txt = el.textContent || el.innerText || '';
  // remove commas and spaces
  const clean = txt.replace(/[, ]+/g,'').trim();
  const n = parseFloat(clean);
  return Number.isFinite(n) ? n : 0;
}
// format with comma
function fmt(n){ 
  if(!Number.isFinite(n)) return '0';
  return Number(n).toLocaleString();
}

// --- Calculation ---
function calculateAll(){
  const kipVal = parseCell('kip');
  const kip2Val = parseCell('kip2');
  const kip3Val = parseCell('kip3');
  const cash4Val = (kipVal/640) || 0;
  const cash5Val = (kip2Val/640) || 0;
  const cash6Val = (kip3Val/640) || 0;

  // show results with formatting
  document.getElementById('cash4').textContent = fmt(Math.round(cash4Val));
  document.getElementById('cash5').textContent = fmt(Math.round(cash5Val));
  document.getElementById('cash6').textContent = fmt(Math.round(cash6Val));

  const total1 = parseCell('credit_in')-parseCell('credit_in2')-parseCell('credit_in3')-parseCell('credit_in4')-parseCell('credit_in5')
                + parseCell('credit_out')+parseCell('credit_out2')+parseCell('credit_out3')+parseCell('credit_out4');
  document.getElementById('total1').textContent = fmt(total1);

  const totalExpenses = parseCell('cash') + parseCell('ticket') + parseCell('promo') 
                        + parseCell('cash2') + parseCell('cash3') + cash4Val + cash5Val + cash6Val
                        + parseCell('expense') + parseCell('expenseOL');
  document.getElementById('totalExpenses').textContent = fmt(Math.round(totalExpenses));

  // Grand total: credit net + cash_open - cash_close + bank_close
  const grand = parseCell('cash_close')-parseCell('cash_open')+parseCell('total1') ;
  document.getElementById('grand_total').textContent = fmt(Math.round(grand));
}

// --- auto calculate on edit ---
// Attach 'input' and 'blur' events to keep formatting friendly
editableIds.forEach(id=>{
  const el=document.getElementById(id);
  if(!el) return;
  el.addEventListener('input', calculateAll);
  el.addEventListener('blur', ()=>{
    const v = parseCell(id);
    el.textContent = fmt(Math.round(v));
  });
});
calculateAll();

// --- Buttons ---
// Paste from clipboard
document.getElementById('pasteData').addEventListener('click', async ()=>{
  try{
    const text = await navigator.clipboard.readText();
    const rows = text.split('\n').map(r=>r.split('\t'));
    rows.forEach(r=>{
      const id = r[0]?.trim();
      const val = r[1]?.trim();
      if(id && document.getElementById(id)) document.getElementById(id).textContent = val;
    });
    calculateAll();
  }catch(e){alert('‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫ß‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÑ‡∫î‡ªâ');}
});

// Copy CSV
document.getElementById('copy').addEventListener('click', ()=>{
  const headers = ["ID","Value"];
  const data = editableIds.map(id=>[id, parseCell(id)]);
  const csv = [headers.join(','), ...data.map(r=>r.join(','))].join('\n');
  navigator.clipboard.writeText(csv).then(()=>alert('Copied CSV!'));
});

// Download PNG
document.getElementById('downloadImg').addEventListener('click', ()=>{
  html2canvas(document.getElementById('reportCard')).then(canvas=>{
    const link = document.createElement('a');
    link.download = 'report.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
});

// Download XLSX
document.getElementById('downloadXlsx').addEventListener('click', ()=>{
  const wb = XLSX.utils.book_new();
  const ws_data = [["ID","Value"], ...editableIds.map(id=>[id, parseCell(id)])];
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb, ws, 'Report');
  XLSX.writeFile(wb, 'report.xlsx');
});

// --- Reset modal logic ---
const confirmOverlay = document.getElementById('confirmModalOverlay');
const btnReset = document.getElementById('reset');
const btnYes = document.getElementById('confirmYes');
const btnNo = document.getElementById('confirmNo');

btnReset.addEventListener('click', ()=> {
  confirmOverlay.style.display = 'flex';
  confirmOverlay.setAttribute('aria-hidden','false');
});

// confirm reset
btnYes.addEventListener('click', ()=>{
  // optional: keep a short snapshot if you want undo (not implemented here)
  editableIds.forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.textContent = '0';
  });
  calculateAll();
  confirmOverlay.style.display = 'none';
  confirmOverlay.setAttribute('aria-hidden','true');
  alert("‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!");
});

// cancel reset
btnNo.addEventListener('click', ()=>{
  confirmOverlay.style.display = 'none';
  confirmOverlay.setAttribute('aria-hidden','true');
});

// click outside modal to close (for accessibility)
confirmOverlay.addEventListener('click', (e)=>{
  if(e.target === confirmOverlay){
    confirmOverlay.style.display = 'none';
    confirmOverlay.setAttribute('aria-hidden','true');
  }
});

// --- WhatsApp modal logic ---
const waOverlay = document.getElementById('whatsappModalOverlay');
const btnSend = document.getElementById('sendWhatsApp');
const btnCancelSend = document.getElementById('cancelSend');
const btnConfirmSend = document.getElementById('confirmSend');
const waPreview = document.getElementById('waPreview');
const waPhone = document.getElementById('waPhone');

function getLabelForId(id){
  const el = document.getElementById(id);
  if(!el) return id;
  const tr = el.closest('tr');
  if(!tr) return id;
  const labelCell = tr.querySelector('td.label');
  return labelCell ? labelCell.innerText.trim() : id;
}

function buildMessage(){
  const now = new Date();
  const dateStr = `${String(now.getDate()).padStart(2,'0')}/${String(now.getMonth()+1).padStart(2,'0')}/${now.getFullYear()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  
  let lines = [];
  lines.push(`üìä ‡∫™‡∫∞‡∫´‡∫º‡∫∏‡∫ö‡∫•‡∫≤‡∫ç‡∫Æ‡∫±‡∫ö - ‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç (${dateStr})`);
  lines.push('');
  editableIds.forEach(id=>{
    const el = document.getElementById(id);
    const label = getLabelForId(id);
    const value = fmt(parseCell(id));
    lines.push(`‚Ä¢ ${label}: ${value}`);
  });
  lines.push('');
  lines.push(`TotalExpenses: ${document.getElementById('totalExpenses').textContent} 	‡∏ø`);
  lines.push(`Grand Total: ${document.getElementById('grand_total').textContent} 	‡∏ø`);
  lines.push(`‡∫™‡∫ª‡ªà‡∫á‡∫≠‡∫≠‡∫Å‡∫à‡∫≤‡∫Å‡∫•‡∫∞‡∫ö‡∫ª‡∫ö: ${document.getElementById('grand_total').textContent} `);
  return lines.join('\n');
}


// open preview modal + render message preview
btnSend.addEventListener('click', ()=>{
  waOverlay.style.display = 'flex';
  waOverlay.setAttribute('aria-hidden','false');
  waPhone.value = ''; // empty by default
  waPreview.textContent = buildMessage();
});

// cancel send
btnCancelSend.addEventListener('click', ()=>{
  waOverlay.style.display = 'none';
  waOverlay.setAttribute('aria-hidden','true');
});

// click outside modal to close
waOverlay.addEventListener('click', (e)=>{
  if(e.target === waOverlay){
    waOverlay.style.display = 'none';
    waOverlay.setAttribute('aria-hidden','true');
  }
});

// confirm send: open wa.me or wa link with text
btnConfirmSend.addEventListener('click', ()=>{
  const phoneRaw = waPhone.value.trim();
  const msg = buildMessage();
  if(phoneRaw === ''){
    // open generic WhatsApp web composer with text
    const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
    waOverlay.style.display = 'none';
    waOverlay.setAttribute('aria-hidden','true');
    return;
  }
  // Normalize phone: remove non-digits
  const phoneClean = phoneRaw.replace(/[^\d]/g,'');
  if(!phoneClean){
    alert('‡ªÉ‡∫™‡ªà‡ªÄ‡∫ö‡∫µ WhatsApp ‡∫º‡∫ç‡ªà‡∫≠‡∫á‡∫ñ‡∫∑‡∫Å (‡ªÄ‡∫ä‡∫±‡ªà‡∫ô 85620xxxxxxx)');
    return;
  }
  const url = `https://wa.me/${phoneClean}?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');
  waOverlay.style.display = 'none';
  waOverlay.setAttribute('aria-hidden','true');
});

// update preview if user edits phone or manually wants refresh (optional)
waPhone.addEventListener('input', ()=> {
  waPreview.textContent = buildMessage();
});

// --- make sure initial formatting (show commas) ---
editableIds.forEach(id=>{
  const el = document.getElementById(id);
  if(el){
    const v = parseCell(id);
    el.textContent = fmt(Math.round(v));
  }
});
calculateAll();
// --- ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å localStorage ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ ---
editableIds.forEach(id => {
  const saved = localStorage.getItem(id);
  if(saved !== null && document.getElementById(id)) {
    document.getElementById(id).textContent = saved;
  }
});

// --- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏•‡∏á localStorage ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---
editableIds.forEach(id=>{
  const el=document.getElementById(id);
  if(!el) return;
  el.addEventListener('input', ()=> {
    const v = parseCell(id);
    localStorage.setItem(id, fmt(Math.round(v)));
    calculateAll();
  });
  el.addEventListener('blur', ()=>{
    const v = parseCell(id);
    el.textContent = fmt(Math.round(v));
    localStorage.setItem(id, fmt(Math.round(v)));
  });
});

// --- Reset ‡∏Å‡πá‡∏•‡πâ‡∏≤‡∏á localStorage ‡∏î‡πâ‡∏ß‡∏¢ ---
btnYes.addEventListener('click', ()=>{
  editableIds.forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.textContent = '0';
    localStorage.removeItem(id);
  });
  calculateAll();
  confirmOverlay.style.display = 'none';
  confirmOverlay.setAttribute('aria-hidden','true');
  alert("‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!");
});

</script>
<script>
 // Move to next row on Enter
editableIds.forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
      // ‡∏´‡∏≤ index ‡∏Ç‡∏≠‡∏á element ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const idx = editableIds.indexOf(id);
      if(idx >= 0 && idx < editableIds.length-1){
        const nextEl = document.getElementById(editableIds[idx+1]);
        if(nextEl){
          nextEl.focus();
          // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ text ‡∏Å‡πá select ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          if(nextEl.select) nextEl.select();
        }
      }
    }
  });
});
function calculateAll(){
  const kipVal = parseCell('kip');
  const kip2Val = parseCell('kip2');
  const kip3Val = parseCell('kip3');
  const cash4Val = (kipVal/640) || 0;
  const cash5Val = (kip2Val/640) || 0;
  const cash6Val = (kip3Val/640) || 0;

  // show results with formatting
  const cash4El = document.getElementById('cash4');
  const cash5El = document.getElementById('cash5');
  const cash6El = document.getElementById('cash6');
  cash4El.textContent = fmt(Math.round(cash4Val));
  cash5El.textContent = fmt(Math.round(cash5Val));
  cash6El.textContent = fmt(Math.round(cash6Val));
  cash4El.style.color = cash4Val < 0 ? 'red' : '';
  cash5El.style.color = cash5Val < 0 ? 'red' : '';
  cash6El.style.color = cash6Val < 0 ? 'red' : '';

  const total1 = parseCell('credit_in')-parseCell('credit_in2')-parseCell('credit_in3')-parseCell('credit_in4')-parseCell('credit_in5')
                + parseCell('credit_out')+parseCell('credit_out2')+parseCell('credit_out3')+parseCell('credit_out4');
  const total1El = document.getElementById('total1');
  total1El.textContent = fmt(total1);
  total1El.style.color = total1 < 0 ? 'red' : '';

  const totalExpenses = parseCell('cash') + parseCell('ticket') + parseCell('promo') 
                        + parseCell('cash2') + parseCell('cash3') + cash4Val + cash5Val + cash6Val
                        + parseCell('expense') + parseCell('expenseOL');
  const totalExpensesEl = document.getElementById('totalExpenses');
  totalExpensesEl.textContent = fmt(Math.round(totalExpenses));
  totalExpensesEl.style.color = totalExpenses < 0 ? 'red' : '';

  // Grand total: credit net + cash_open - cash_close + bank_close
  const grand = parseCell('cash_close')-parseCell('cash_open')+parseCell('total1') ;
  const grandEl = document.getElementById('grand_total');
  grandEl.textContent = fmt(Math.round(grand));
  grandEl.style.color = grand < 0 ? 'red' : '';
}



window.onload = function() {
  document.getElementById("show").innerText = localStorage.getItem("expenseOL") || "‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô";
};
</script>


<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</title>
<style>
  .sticky-ad {
    position: fixed;
    right: 18px;
    bottom: 18px;
    width: 320px;
    max-width: calc(100% - 36px);
    z-index: 99999;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    border-radius: 12px;
    overflow: hidden;
    background: #fff;
    transition: transform .25s, opacity .25s;
    transform-origin: 100% 100%;
    font-family: sans-serif;
  }
  @media (max-width: 420px) {
    .sticky-ad { right: 12px; left: 12px; bottom: 12px; width: auto; }
  }
  .sticky-ad img.ad-img {
    display: block;
    width: 100%;
    height: auto;
    object-fit: cover;
  }
  .sticky-ad .ad-bar {
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:8px 12px;
    background: #f3f3f3;
  }
  .sticky-ad .ad-text {
    font-size:14px;
    color:#222;
    flex:1;
    margin-right:10px;
  }
  .sticky-ad button.close-btn {
    border:0;
    background:#ff4d4d;
    color:#fff;
    width:28px;
    height:28px;
    cursor:pointer;
    font-size:18px;
    font-weight:bold;
    border-radius:50%;
    line-height:1;
    transition: background .2s;
  }
  .sticky-ad button.close-btn:hover {
    background:#cc0000;
  }
  .sticky-ad.show { transform: scale(1); opacity:1; }
  .sticky-ad.hide { transform: scale(.9); opacity:0; pointer-events:none; }
</style>
</head>
<body>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ -->
<div id="stickyAd" class="sticky-ad hide">
  <!-- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏π‡∏õ -->
  <a id="adLink" href="https://example.com" target="_blank" rel="noopener noreferrer">
    <img id="adImg" class="ad-img" alt="‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤" loading="lazy" 
         src="cc.jpg">
  </a>
  <div class="ad-bar">
    <div class="ad-text">‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© ‚Äî ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
    <button class="close-btn" id="adCloseBtn" aria-label="‡∏õ‡∏¥‡∏î‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤">&times;</button>
  </div>
</div>

<script>
(function(){
  const adEl   = document.getElementById('stickyAd');
  const imgEl  = document.getElementById('adImg');
  const closeBtn = document.getElementById('adCloseBtn');

  function showAd() {
    adEl.classList.remove('hide');
    requestAnimationFrame(()=> adEl.classList.add('show'));
  }
  function hideAd() {
    adEl.classList.remove('show');
    adEl.classList.add('hide');
  }
  closeBtn.addEventListener('click', hideAd);
  document.addEventListener('keydown', e => { if(e.key==="Escape") hideAd(); });

  // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏ñ‡πâ‡∏≤‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
  imgEl.addEventListener('load', function(){
    const maxH = Math.min(window.innerHeight * 0.6, 600);
    if (imgEl.naturalHeight > maxH) {
      imgEl.style.maxHeight = maxH + 'px';
      imgEl.style.width = '100%';
    }
  });

  // ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ 0.3 ‡∏ß‡∏¥
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', ()=> setTimeout(showAd, 300));
  } else setTimeout(showAd, 300);
})();
</script>

</body>
</html>


</body>
</html>


